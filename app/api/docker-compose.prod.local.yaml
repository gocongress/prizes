name: api-prod-local

services:
  api:
    build:
      dockerfile: ./Dockerfile.prod
    ports:
      - '${API_HOST_PORT}:3001'
    environment:
      SERVICE_NAME: api
      NODE_ENV: production
      LOG_LEVEL: ${LOG_LEVEL:-info}
      JWT_SECRET_KEY: ${JWT_SECRET_KEY}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-7d}
      SEED_DATA: ${SEED_DATA:-false}
      SERVER_HOST: 0.0.0.0
      SERVER_PORT: 3001
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS}
      DB_USER: ${DB_USER:-postgres}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_HOST: postgres
      DB_PORT: 5432
      DB_NAME: ${DB_NAME:-postgres}
      DB_SCHEMA: api
      DB_SSL: ${DB_SSL:-0}
      ADMIN_EMAILS: ${ADMIN_EMAILS}
      OTP_CODE_LENGTH: ${OTP_CODE_LENGTH:-8}
      COOKIE_DOMAIN: ${COOKIE_DOMAIN}
      SMTP2GO_ENABLED: ${SMTP2GO_ENABLED:-false}
      SMTP2GO_API_KEY: ${SMTP2GO_API_KEY}
      SMTP2GO_FROM_EMAIL: ${SMTP2GO_FROM_EMAIL}
      SMTP2GO_FROM_NAME: ${SMTP2GO_FROM_NAME}
      TURNSTILE_ENABLED: ${TURNSTILE_ENABLED:-false}
      TURNSTILE_SECRET_KEY: ${TURNSTILE_SECRET_KEY}
      TURNSTILE_TIMEOUT: ${TURNSTILE_TIMEOUT:-3000}
      REGFOX_WEBHOOK_SIGNING_SECRET: ${REGFOX_WEBHOOK_SIGNING_SECRET}
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped
    networks:
      - api-net

networks:
  api-net:
    driver: bridge
