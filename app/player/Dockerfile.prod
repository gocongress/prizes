# Build stage
FROM localhost/microservice-prod AS build
COPY package.json tsconfig.json eslint.config.js vite.config.ts index.html tsr.config.json components.json .cta.json .env.production ./app/player/
COPY public ./app/player/public/
COPY src ./app/player/src/
# Create .tanstack directory for TanStack Router CLI
RUN mkdir -p /workspace/app/player/.tanstack/tmp
RUN npm install --workspace=app/player
RUN npm run build -w app/player

# Production stage - serve with simple HTTP server
FROM localhost/microservice-prod
ENV NODE_ENV=production
RUN npm install -g serve
WORKDIR /workspace/app/player
COPY --from=build /workspace/app/player/dist ./dist
EXPOSE 3002
CMD ["serve", "-s", "dist", "-l", "3002"]
